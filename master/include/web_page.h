#ifndef WEB_PAGE_H
#define WEB_PAGE_H
#define WEB_PAGE "<html><head><title>ClockClock 24 (replica)</title><link rel=icon href=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 490 490'%3E%3Cstyle xmlns='http://www.w3.org/2000/svg'%3E %23fav %7B stroke: %23000; fill: %23000; %7D @media (prefers-color-scheme: dark) %7B %23fav %7B stroke: %23fff; fill: %23fff; %7D %7D %3C/style%3E%3Cg id='fav'%3E%3Cg%3E%3Cpath d='M233.004,0C104.224,0,0,104.212,0,233.004c0,128.781,104.212,233.004,233.004,233.004 c128.782,0,233.004-104.212,233.004-233.004C466.008,104.222,361.796,0,233.004,0z M244.484,242.659l-63.512,75.511 c-5.333,6.34-14.797,7.156-21.135,1.824c-6.34-5.333-7.157-14.795-1.824-21.135l59.991-71.325V58.028c0-8.284,6.716-15,15-15 s15,6.716,15,15v174.976h0C248.004,236.536,246.757,239.956,244.484,242.659z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\"type=image/svg+xml><style>html{width:100%;height:100%}body{display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:Tahoma,Helvetica,sans-serif;color:#fff;background-color:#212121;cursor:default;user-select:none;font-size:14px}#art{margin:80px 0}.title{font-size:16px;font-weight:700;margin-bottom:8px;text-align:center}.text{margin-bottom:8px;text-align:center}a{color:#8a8a8a;text-decoration:none}.half-digit{float:left}.clock{--small-hand:90deg;--large-hand:90deg;--animation-time:15s;width:8vw;height:8vw;border-radius:50%;box-shadow:inset 0 0 3px #fff;float:left;cursor:pointer;position:absolute}.clock:nth-of-type(n+1){clear:left}.clock-largeHand,.clock-smallHand{transform-origin:50px center;transition-timing-function:ease;transition:transform var(--animation-time)}.clock-smallHand{transform:rotateZ(var(--small-hand))}.clock-largeHand{transform:rotateZ(var(--large-hand))}.hidden .btn-clock{display:none}#external.hidden{display:none}.btn-clock{position:absolute;width:4vw;height:4vw;background-color:#212121dc;box-shadow:inset 0 0 3px #fff;font-size:.8vw;font-weight:700;display:flex;flex-direction:row;align-content:center;justify-content:center;align-items:center;cursor:pointer}.btn-clock:hover{background-color:#c60a0a}.btn-clock.btn-clock-tl{border-radius:4vw 0 0 0}.btn-clock.btn-clock-tr{margin-left:4vw;border-radius:0 4vw 0 0}.btn-clock.btn-clock-bl{margin-top:4vw;border-radius:0 0 0 4vw}.btn-clock.btn-clock-br{margin-left:4vw;margin-top:4vw;border-radius:0 0 4vw 0}.clock-box{width:8vw;height:8vw;margin:.2vw}.btn{width:72px;height:48px;margin:4px;margin-bottom:8px;font-size:14px;border-width:0;padding:0;background-color:transparent;color:#fff;box-shadow:inset 0 0 2px #dfdfdf;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;float:left}.btn:hover{background-color:#b4b4b44b}.btn.active{background-color:#dfdfdf;box-shadow:inset 0 0 0 2px #dfdfdf;color:#000}.btn.day-active{background-color:#dfdfdf;box-shadow:inset 0 0 0 2px #dfdfdf;color:#000;padding-bottom:8px;margin-bottom:0}.checkbox{width:44px;height:16px;box-shadow:inset 0 0 1px #000;float:left;margin:2px;margin-bottom:8px}.checkbox:hover{background-color:#b4b4b4}.checkbox.selected{background-color:#000}.hour-text{width:48px;height:16px;color:#212121dc;display:flex;flex-direction:column;align-items:center;justify-content:center;float:left;font-size:12px;margin-top:4px}.spacer{height:24px}.input-text{width:172px;height:48px;margin:4px;box-shadow:inset 0 0 2px #dfdfdf;background-color:transparent;border-color:transparent;color:#fff;padding-top:0;padding-bottom:0;padding-left:16px;padding-right:16px;font-size:16px;float:left;display:inline;white-space:nowrap;border-width:0}.input-text:focus-visible{outline:transparent}.input-text::selection{color:#000;background:#fff}.hours-box{background-color:#dfdfdf;display:flex;flex-direction:column;align-items:center;padding:16px}</style></head><body id=body><div class=spacer></div><h1>ClockClock 24 (replica)</h1><div id=art></div><div class=spacer></div><div class=title>Mode</div><div id=modes></div><div class=spacer></div><div class=title>Speed Multiplier</div><div><input type=number id=multiplier style=width:100px class=input-text min=1> <button class=btn style=width:100px onclick=saveClockSettings()>SAVE</button></div><div class=spacer></div><div class=title>Sleep Time</div><div id=days></div><div id=hours></div><div class=spacer></div><div class=title>Wireless Connection</div><div id=wifi><div class=btn style=width:150px id=con-0 onclick=selectConnection(0)>HOTSPOT</div><div class=btn style=width:150px id=con-1 onclick=selectConnection(1)>EXTERNAL</div></div><form id=external class=hidden onsubmit=return!1><input id=hostname class=input-text placeholder=HOSTNAME> <input id=ssid class=input-text placeholder=SSID minlength=1 required> <input type=password id=password class=input-text placeholder=PASSWORD minlength=1 required> <button type=submit class=btn style=width:100px onclick=saveConnection()>SAVE</button></form><div class=spacer></div><div class=title>MQTT Configuration</div><form id=mqtt-form onsubmit=return!1><div style=display:flex;align-items:center;margin:4px><input type=checkbox id=mqtt-enabled style=\"width:20px;height:20px;margin:0 8px 0 0;cursor:pointer\"> <label for=mqtt-enabled style=cursor:pointer>Enable MQTT</label></div><input id=mqtt-broker class=input-text placeholder=\"BROKER ADDRESS\"> <input type=number id=mqtt-port class=input-text placeholder=PORT value=1883 min=1 max=65535> <input id=mqtt-username class=input-text placeholder=\"USERNAME (optional)\"> <input type=password id=mqtt-password class=input-text placeholder=\"PASSWORD (optional)\"> <button type=submit class=btn style=width:100px onclick=saveMqttConfig()>SAVE</button></form><div class=spacer></div><div class=title>OTA Update</div><a href=/update><button class=btn style=width:150px>ElegantOTA</button></a><div class=spacer></div><div class=spacer></div><div class=text><p><small>Code</small><br><a href=https://github.com/vallasc>Giacomo Vallorani</a><br><a href=https://github.com/whosmatt>whosmatt</a></p><p><small>Clock animation</small><br><a href=https://manu.ninja/ >Manuel Wieser</a></p><p><small>Design</small><br><a href=http://www.humanssince1982.com/ >Humans since 1982</a></p></div><script>let sleep=[Array(24).fill(0),Array(24).fill(0),Array(24).fill(0),Array(24).fill(0),Array(24).fill(0),Array(24).fill(0),Array(24).fill(0)],selectedMode=0,clockEnabled=!0,selectedClock=void 0,selectedDay=void 0,selectedConnection=void 0,speedMultiplier=1,ssid=\"\",password=\"\",hostname=\"\",mqttEnabled=!1,mqttBroker=\"\",mqttPort=1883,mqttUsername=\"\",mqttPassword=\"\";function clock(e){return`<div id=\"clock-${e}\" class=\"clock-box hidden\"><svg class=\"clock clock--${e}\" width=\"100\" height=\"100\" viewBox=\"0 0 100 100\" onclick=\"selectClock(${e})\"><path class=\"clock-smallHand\" d=\"M50,47 C48.3431458,47 47,48.3431458 47,50 C47,51.6568542 48.3431458,53 50,53 L95,53 L95,47 L50,47 Z\" stroke=\"none\" fill=\"#FFF\" fill-rule=\"evenodd\"></path><path class=\"clock-largeHand\" d=\"M50,47 C48.3431458,47 47,48.3431458 47,50 C47,51.6568542 48.3431458,53 50,53 L100,53 L100,47 L50,47 Z\" stroke=\"none\" fill=\"#FFF\" fill-rule=\"evenodd\"></path></svg><div class=\"btn-clock btn-clock-tl\" onclick=\"adjustHand(${e}, 0, 1)\">H+</div><div class=\"btn-clock btn-clock-tr\" onclick=\"adjustHand(${e}, 1, 0)\">M+</div><div class=\"btn-clock btn-clock-bl\" onclick=\"adjustHand(${e}, 0, -1)\">H-</div><div class=\"btn-clock btn-clock-br\" onclick=\"adjustHand(${e}, -1, 0)\">M-</div></div>`}function genModes(){var e;let t=`<div id=\"clock-enabled\" class=\"btn ${clockEnabled?\"active\":\"\"}\" style=\"width: 100px; margin-bottom: 16px;\" onclick=\"toggleClockEnabled()\">${clockEnabled?\"ON\":\"OFF\"}</div>`,l=0;for(e of[\"LAZY\",\"FUN\",\"WAVES\"])t+=`<div id=\"mode-${l}\" class=\"btn ${l===selectedMode?\"active\":\"\"}\" onclick=\"selectMode(${l++})\">${e}</div>`;document.getElementById(\"modes\").innerHTML=t}function genClocks(){let t='<div class=\"half-digit\">';for(let e=0;e<24;e++)e%3==0&&0!=e&&(t+='</div><div class=\"half-digit\">'),t+=clock(e);t+=\"</div>\",document.getElementById(\"art\").innerHTML=t}function genDays(){var e;let t=\"\",l=0;for(e of[\"MON\",\"TUE\",\"WED\",\"THU\",\"FRI\",\"SAT\",\"SUN\"])t+=`<div id=\"day-${l}\" class=\"btn\" onclick=\"selectDay(${l++})\">${e}</div>`;document.getElementById(\"days\").innerHTML=t}function genHours(t){let l='<div class=\"hours-box\"><div>';for(let e=0;e<=12;e++)l+=`<div class=\"hour-text\">${e}</div>`;l+=\"</div><div>\";for(let e=0;e<12;e++)l+=`<div id=\"hour-${e}\" class=\"checkbox ${1===sleep[t][e]?\"selected\":\"\"}\" onclick=\"selectHour(${e})\"></div>`;l+=\"</div><div>\";for(let e=12;e<=24;e++)l+=`<div class=\"hour-text\">${e%24}</div>`;l+=\"</div><div>\";for(let e=12;e<24;e++)l+=`<div id=\"hour-${e}\" class=\"checkbox ${1===sleep[t][e]?\"selected\":\"\"}\" onclick=\"selectHour(${e})\"></div>`;l+=\"</div></div>\",document.getElementById(\"hours\").innerHTML=l}function selectMode(e){void 0!==selectedMode&&document.getElementById(\"mode-\"+selectedMode).classList.remove(\"active\"),selectedMode=e,document.getElementById(\"mode-\"+selectedMode).classList.add(\"active\"),saveMode(selectedMode,clockEnabled)}function toggleClockEnabled(){clockEnabled=!clockEnabled;var e=document.getElementById(\"clock-enabled\");e.textContent=clockEnabled?\"ON\":\"OFF\",clockEnabled?e.classList.add(\"active\"):e.classList.remove(\"active\"),(clockEnabled?startClock:stopClock)(),saveMode(selectedMode,clockEnabled)}function selectDay(e){deselectDay(),selectedDay!==e&&(selectedDay=e,document.getElementById(\"day-\"+selectedDay).classList.add(\"day-active\"),genHours(e))}function deselectDay(){void 0!==selectedDay&&document.getElementById(\"day-\"+selectedDay).classList.remove(\"day-active\"),selectedDay=void 0,document.getElementById(\"hours\").innerHTML=\"\"}function selectHour(e){var t=sleep[parseInt(selectedDay)][e];sleep[parseInt(selectedDay)][e]=1===t?0:1,0===t?document.getElementById(\"hour-\"+e).classList.add(\"selected\"):document.getElementById(\"hour-\"+e).classList.remove(\"selected\"),saveSleepTime(selectedDay,sleep[parseInt(selectedDay)])}function deselectClock(){void 0!==selectedClock&&document.getElementById(\"clock-\"+selectedClock).classList.add(\"hidden\"),selectedClock=void 0}function selectClock(e){deselectClock(),selectedClock=e,document.getElementById(\"clock-\"+selectedClock).classList.remove(\"hidden\")}function selectConnection(e){void 0!==selectedConnection&&(document.getElementById(\"con-\"+selectedConnection).classList.remove(\"active\"),document.getElementById(\"external\").classList.add(\"hidden\")),0===e&&selectedConnection!==e&&void 0!==selectedConnection?(selectedConnection=e,saveConnection()):selectedConnection=e,1===e&&document.getElementById(\"external\").classList.remove(\"hidden\"),document.getElementById(\"con-\"+selectedConnection).classList.add(\"active\")}function sendDate(){var e=new Date,t=new FormData;t.append(\"h\",e.getHours().toString()),t.append(\"m\",e.getMinutes().toString()),t.append(\"s\",e.getSeconds().toString()),t.append(\"D\",e.getDate().toString()),t.append(\"M\",(e.getMonth()+1).toString()),t.append(\"Y\",e.getFullYear().toString()),t.append(\"timezone\",(e.getTimezoneOffset()/-60).toString()),fetch(\"/time\",{method:\"post\",body:t})}async function updateConfig(){var e=await(await fetch(\"/config\",{method:\"get\"})).json();sleep=e.sleep_time,void 0!==selectedDay&&genHours(selectedDay),selectedMode=e.clock_mode,clockEnabled=void 0===e.clock_enabled||e.clock_enabled,genModes(),clockEnabled||stopClock(),selectConnection(e.wireless_mode),speedMultiplier=e.speed_multiplier||1,document.getElementById(\"multiplier\").value=speedMultiplier,document.getElementById(\"ssid\").value=ssid=e.ssid,document.getElementById(\"password\").value=password=e.password,document.getElementById(\"hostname\").value=hostname=e.hostname,mqttEnabled=e.mqtt_enabled||!1,mqttBroker=e.mqtt_broker||\"\",mqttPort=e.mqtt_port||1883,mqttUsername=e.mqtt_username||\"\",document.getElementById(\"mqtt-enabled\").checked=mqttEnabled,document.getElementById(\"mqtt-broker\").value=mqttBroker,document.getElementById(\"mqtt-port\").value=mqttPort,document.getElementById(\"mqtt-username\").value=mqttUsername}function adjustHand(e,t,l){var o=new FormData;o.append(\"index\",e.toString()),o.append(\"m_amount\",t.toString()),o.append(\"h_amount\",l.toString()),fetch(\"/adjust\",{method:\"post\",body:o})}function saveMode(e,t){var l=new FormData;l.append(\"mode\",e.toString()),l.append(\"enabled\",t?\"1\":\"0\"),fetch(\"/mode\",{method:\"post\",body:l})}function saveClockSettings(){speedMultiplier=parseInt(document.getElementById(\"multiplier\").value);var e=new FormData;e.append(\"multiplier\",speedMultiplier.toString()),fetch(\"/settings\",{method:\"post\",body:e})}document.addEventListener(\"click\",function(e){\"body\"===e.target.id&&(deselectClock(),deselectDay())}),genClocks(),genModes(),genDays();let lastSleepDay=void 0,sleepTimeout=void 0;function saveSleepTime(e,l){lastSleepDay===e&&clearTimeout(sleepTimeout),lastSleepDay=e,sleepTimeout=setTimeout(()=>{var t=new FormData;t.append(\"day\",e.toString());for(let e=0;e<24;e++)t.append(\"h\"+e,l[e].toString());fetch(\"/sleep\",{method:\"post\",body:t})},1500)}async function saveConnection(){ssid=document.getElementById(\"ssid\").value,password=document.getElementById(\"password\").value,hostname=document.getElementById(\"hostname\").value;var e=new FormData;e.append(\"mode\",selectedConnection.toString()),e.append(\"ssid\",ssid),e.append(\"password\",password),e.append(\"hostname\",hostname),await fetch(\"/connection\",{method:\"post\",body:e}),setTimeout(()=>location.reload(),2e3)}async function saveMqttConfig(){mqttEnabled=document.getElementById(\"mqtt-enabled\").checked,mqttBroker=document.getElementById(\"mqtt-broker\").value,mqttPort=parseInt(document.getElementById(\"mqtt-port\").value),mqttUsername=document.getElementById(\"mqtt-username\").value,mqttPassword=document.getElementById(\"mqtt-password\").value;var e=new FormData;e.append(\"enabled\",mqttEnabled?\"1\":\"0\"),e.append(\"broker\",mqttBroker),e.append(\"port\",mqttPort.toString()),e.append(\"username\",mqttUsername),e.append(\"password\",mqttPassword),await fetch(\"/mqtt\",{method:\"post\",body:e}),alert(\"MQTT configuration saved\")}sendDate(),updateConfig();const digit_stop=[[270,270],[270,270],[270,270],[270,270],[270,270],[270,270]],digit_II=[[270,90],[270,90],[270,90],[270,90],[270,90],[270,90]],digits=[[[270,0],[270,90],[0,90],[270,180],[270,90],[180,90]],[[225,225],[225,225],[225,225],[270,270],[270,90],[90,90]],[[0,0],[270,0],[90,0],[180,270],[90,180],[180,180]],[[0,0],[0,0],[0,0],[180,270],[180,90],[180,90]],[[270,270],[90,0],[225,225],[270,270],[270,90],[90,90]],[[270,0],[90,0],[0,0],[180,180],[270,180],[90,180]],[[270,0],[270,90],[90,0],[180,180],[270,180],[90,180]],[[0,0],[225,225],[225,225],[270,180],[270,90],[90,90]],[[270,0],[90,0],[90,0],[270,180],[90,180],[90,180]],[[270,0],[0,90],[0,0],[270,180],[270,90],[90,180]]];let anim_state=Array(4).fill().map(()=>Array(6).fill().map(()=>[90,90])),current_state=Array(4).fill().map(()=>Array(6).fill().map(()=>[270,270]));function setHands(e,t,l,o){e=document.querySelector(\".clock--\"+e);e.style.setProperty(\"--small-hand\",t+\"deg\"),e.style.setProperty(\"--large-hand\",l+\"deg\"),e.style.setProperty(\"--animation-time\",o+\"s\")}function calcAngleCCW(e,t){t=(t-e)%360;return Math.abs(t<=0?-t:360-t)}function calcAngleCW(e,t){t=(t-e)%360;return Math.abs(t<0?360+t:t)}function setHalfDigit(t,l,o,n){for(let e=0;e<3;e++){var d=current_state[Math.floor(t/2)][e+t%2*3],c=anim_state[Math.floor(t/2)][e+t%2*3],s=calcAngleCW(d[0],l[e][0]),a=calcAngleCCW(d[0],l[e][0]),i=calcAngleCW(d[1],l[e][1]),r=calcAngleCCW(d[1],l[e][1]),m=o%3*360;o<=2?(d[0]=(d[0]-a)%360,d[0]=d[0]<0?d[0]+=360:d[0],c[0]=c[0]+a+m,d[1]=(d[1]-r)%360,d[1]=d[1]<0?d[1]+=360:d[1],c[1]=c[1]+r+m):o<=5?(d[0]=(d[0]+s)%360,c[0]=c[0]-s-m,d[1]=(d[1]+i)%360,c[1]=c[1]-i-m):o<=8?(s<=a?(d[0]=(d[0]+s)%360,c[0]=c[0]-s-m):(d[0]=(d[0]-a)%360,d[0]=d[0]<0?d[0]+=360:d[0],c[0]=c[0]+a+m),i<=r?(d[1]=(d[1]+i)%360,c[1]=c[1]-i-m):(d[1]=(d[1]-r)%360,d[1]=d[1]<0?d[1]+=360:d[1],c[1]=c[1]+r+m)):o<=11&&(a<=s?(d[0]=(d[0]+s)%360,c[0]=c[0]-s-m):(d[0]=(d[0]-a)%360,d[0]=d[0]<0?d[0]+=360:d[0],c[0]=c[0]+a+m),r<=i?(d[1]=(d[1]+i)%360,c[1]=c[1]-i-m):(d[1]=(d[1]-r)%360,d[1]=d[1]<0?d[1]+=360:d[1],c[1]=c[1]+r+m)),setHands(3*t+e,c[0],c[1],n)}}function setDigit(e,t,l,o){setHalfDigit(2*e,t.slice(0,3),l,o),setHalfDigit(2*e+1,t.slice(3,6),l,o)}function setStop(){for(let e=0;e<4;e++)setDigit(e,digit_stop,6,15/Math.pow(speedMultiplier,.7))}function setLazy(t){for(let e=0;e<4;e++)setDigit(e,digits[t.charAt(e)],6,15/Math.pow(speedMultiplier,.7))}function setFun(t){for(let e=0;e<4;e++)setDigit(e,digits[t.charAt(e)],1,16/Math.pow(speedMultiplier,.7))}function setWaves(t){const l=Math.pow(speedMultiplier,.7);for(let e=0;e<4;e++)setDigit(e,digit_II,6,8/l);for(let e=0;e<8;e++)setTimeout(()=>{setHalfDigit(e,digit_II,1,18/l)},(7e3+400*(e+1))/l);for(let e=0;e<4;e++)setTimeout(()=>{setDigit(e,digits[t.charAt(e)],0,15/l)},(16e3+400*(2*e+1))/l)}let lastTime;function setTime(){var e=new Date,t=e.toTimeString().substring(0,5).replace(\":\",\"\"),l=(e.getDay()+6)%7,e=e.getHours();if(t!==lastTime&&0===sleep[l][e]&&clockEnabled)switch(lastTime=t,selectedMode){case 0:setLazy(lastTime);break;case 1:setFun(lastTime);break;case 2:setWaves(lastTime)}else 1!==sleep[l][e]&&clockEnabled||setStop()}let clockInterval=void 0;function startClock(){void 0===clockInterval&&(lastTime=void 0,clockInterval=setInterval(setTime,500))}function stopClock(){clearInterval(clockInterval),clockInterval=void 0,setTimeout(setStop,100/Math.pow(speedMultiplier,.7))}let lastClockInterval=void 0;document.addEventListener(\"visibilitychange\",e=>{\"visible\"==document.visibilityState?void 0!==lastClockInterval&&(clockInterval=setInterval(setTime,500)):(lastClockInterval=clockInterval,clearInterval(clockInterval))}),startClock()</script></body></html>"
#endif